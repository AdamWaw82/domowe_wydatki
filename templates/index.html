<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista Wydatków Rodzinnych</title>
    <!-- Link do Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
    <h2 class="text-center mb-4">Lista Wydatków Rodzinnych</h2>
    <div class="text-right mb-3">
        <button class="btn btn-success" data-toggle="modal" data-target="#addExpenseModal">Dodaj nowy wydatek</button>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>Data</th>
                    <th>Kategoria</th>
                    <th>Opis</th>
                    <th>Kwota</th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody>
                {% for field in lista_wydatkow %}
                <tr>
                    <td>{{field.date}}</td>
                    <td>{{field.kategoria}}</td>
                    <td>{{field.opis}}</td>
                    <td>{{field.kwota}}</td>
                    <td>
                        <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#viewExpenseModal"    data-date="{{field.date}}" data-category="{{field.kategoria}}" data-description="{{field.opis}}" data-amount="{{field.kwota}}"   >Podgląd</button>
                        <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editExpenseModal" data-date="{{field.date}}" data-category="{{field.kategoria}}" data-description="{{field.opis}}" data-amount="{{field.kwota}}"   >Edytuj</button>
                        <button class="btn btn-danger btn-sm"  data-toggle="modal" data-target="#deleteExpenseModal" data-date="{{field.date}}" data-category="{{field.kategoria}}" data-description="{{field.opis}}" data-amount="{{field.kwota}}" >Usuń</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal do dodawania nowego wydatku -->
<div class="modal fade" id="addExpenseModal" tabindex="-1" role="dialog" aria-labelledby="addExpenseModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addExpenseModalLabel">Dodaj nowy wydatek</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addExpenseForm" action="/" method="post">
                    {{ form.hidden_tag() }}
                    {% for field in form if field.widget.input_type != 'hidden' %}
                    <div class="form-group">
                        {{ field.label }} {% if field.flags.required %}*{% endif %}
                        {{ field(class_="form-control")}}
                    </div>
                    {% endfor %}
                    <div class="form-group text-center">
                        <button type="submit" class="btn btn-success">Dodaj Wydatek</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- Modal do podglądu wydatku -->
<div class="modal fade" id="viewExpenseModal" tabindex="-1" role="dialog" aria-labelledby="viewExpenseModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewExpenseModalLabel">Podgląd Wydatku</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p><strong>Data:</strong> <span id="viewDate"></span></p>
                <p><strong>Kategoria:</strong> <span id="viewCategory"></span></p>
                <p><strong>Opis:</strong> <span id="viewDescription"></span></p>
                <p><strong>Kwota:</strong> <span id="viewAmount"></span> PLN</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal do edytowania wydatku -->
<div class="modal fade" id="editExpenseModal" tabindex="-1" role="dialog" aria-labelledby="editExpenseModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editExpenseModalLabel">Edytuj Wydatek</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editExpenseForm" action="/" method="post">
                    <div class="form-group">
                        <label for="editDate">Data:</label>
                        <input type="date" id="editDate" name="date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="editCategory">Kategoria:</label>
                        <select id="editCategory" name="category" class="form-control" required>
                            <option value="">Wybierz kategorię</option>
                            <option value="food">Jedzenie</option>
                            <option value="transport">Transport</option>
                            <option value="utilities">Rachunki</option>
                            <option value="entertainment">Rozrywka</option>
                            <option value="other">Inne</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editDescription">Opis:</label>
                        <textarea id="editDescription" name="description" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editAmount">Kwota:</label>
                        <input type="number" id="editAmount" name="amount" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group text-center">
                        <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal do usunięcia wydatku -->
<div class="modal fade" id="deleteExpenseModal" tabindex="-1" role="dialog" aria-labelledby="deleteExpenseModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteExpenseModalLabel">Podgląd Wydatku</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="deleteExpenseForm" action="/delete" method="post" >
                    <p><strong>Data:</strong> <span id="deleteDate"></span></p>
                    <p><strong>Kategoria:</strong> <span id="deleteCategory"></span></p>
                    <p><strong>Opis:</strong> <span id="deleteDescription"></span></p>
                    <p><strong>Kwota:</strong> <span id="deleteAmount"></span> PLN</p>
                    <div class="form-group text-center">
                        <button type="submit" class="btn btn-primary">Usuń wpis</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Linki do jQuery i Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // Skrypt do obsługi modalu podglądu wydatku
    $('#viewExpenseModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var date = button.data('date');
        var category = button.data('category');
        var description = button.data('description');
        var amount = button.data('amount');

        var modal = $(this);
        modal.find('#viewDate').text(date);
        modal.find('#viewCategory').text(category);
        modal.find('#viewDescription').text(description);
        modal.find('#viewAmount').text(amount);
    });

    $('#editExpenseModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var date = button.data('date');
        var category = button.data('category');
        var description = button.data('description');
        var amount = button.data('amount');

        var modal = $(this);
        modal.find('#editDate').val(date);
        modal.find('#editCategory').val(category);
        modal.find('#editDescription').val(description);
        modal.find('#editAmount').val(amount);
    });


    $('#deleteExpenseModal').on('show.bs.modal', function (event) {
    console.log("TEST");
        var button = $(event.relatedTarget); // Button that triggered the modal
        var date = button.data('date');
        var category = button.data('category');
        var description = button.data('description');
        var amount = button.data('amount');

        var modal = $(this);
        modal.find('#deleteDate').val(date);
        modal.find('#deleteCategory').val(category);
        modal.find('#deleteDescription').val(description);
        modal.find('#deleteAmount').val(amount);
    });
</script>

</body>
</html>
